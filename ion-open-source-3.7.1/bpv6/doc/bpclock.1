.\" Automatically generated by Pod::Man 2.27 (Pod::Simple 3.28)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{
.    if \nF \{
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "BPCLOCK 1"
.TH BPCLOCK 1 "2020-09-24" "perl v5.16.3" "BP executables"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
bpclock \- Bundle Protocol (BP) daemon task for managing scheduled events
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
\&\fBbpclock\fR
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
\&\fBbpclock\fR is a background \*(L"daemon\*(R" task that periodically performs
scheduled Bundle Protocol activities.  It is spawned automatically by
\&\fBbpadmin\fR in response to the 's' command that starts operation of Bundle
Protocol on the local \s-1ION\s0 node, and it is terminated by \fBbpadmin\fR in
response to an 'x' (\s-1STOP\s0) command.
.PP
Once per second, \fBbpclock\fR takes the following action:
.Sp
.RS 4
First it (a) destroys all bundles whose TTLs have expired, (b) enqueues
for re-forwarding all bundles that were expected to have been transmitted
(by convergence-layer output tasks) by now but are still stuck in their
assigned transmission queues, and (c) enqueues for re-forwarding all
bundles for which custody has not yet been taken that were expected to
have been received and acknowledged by now (as noted by invocation of
the \fIbpMemo()\fR function by some convergence-layer adapter that had CL-specific
insight into the appropriate interval to wait for custody acceptance).
.Sp
Then \fBbpclock\fR adjusts the transmission and reception \*(L"throttles\*(R" that
control rates of \s-1LTP\s0 transmission to and reception from neighboring nodes,
in response to data rate changes as noted in the \s-1RFX\s0 database by \fBrfxclock\fR.
.Sp
\&\fBbpclock\fR then checks for bundle origination activity that has been blocked
due to insufficient allocated space for \s-1BP\s0 traffic in the \s-1ION\s0 data store: if
space for bundle origination is now available, \fBbpclock\fR gives the bundle
production throttle semaphore to unblock that activity.
.Sp
Finally, \fBbpclock\fR applies rate control to all convergence-layer protocol
inducts and outducts:
.Sp
.RS 4
For each induct, \fBbpclock\fR increases the current capacity of the duct
by the applicable nominal data reception rate.  If the revised current
capacity is greater than zero, \fBbpclock\fR gives the throttle's semaphore
to unblock data acquisition (which correspondingly reduces the current
capacity of the duct) by the associated convergence layer input task.
.Sp
For each outduct, \fBbpclock\fR increases the current capacity of the duct
by the applicable nominal data transmission rate.  If the revised current
capacity is greater than zero, \fBbpclock\fR gives the throttle's semaphore
to unblock data transmission (which correspondingly reduces the current
capacity of the duct) by the associated convergence layer output task.
.RE
.RE
.RS 4
.RE
.SH "EXIT STATUS"
.IX Header "EXIT STATUS"
.ie n .IP """0""" 4
.el .IP "``0''" 4
.IX Item "0"
\&\fBbpclock\fR terminated, for reasons noted in the \fBion.log\fR file.  If this
termination was not commanded, investigate and solve the problem identified
in the log file and use \fBbpadmin\fR to restart \fBbpclock\fR.
.ie n .IP """1""" 4
.el .IP "``1''" 4
.IX Item "1"
\&\fBbpclock\fR was unable to attach to Bundle Protocol operations, probably because
\&\fBbpadmin\fR has not yet been run.
.SH "FILES"
.IX Header "FILES"
No configuration files are needed.
.SH "ENVIRONMENT"
.IX Header "ENVIRONMENT"
No environment variables apply.
.SH "DIAGNOSTICS"
.IX Header "DIAGNOSTICS"
The following diagnostics may be issued to the \fBion.log\fR log file:
.IP "bpclock can't attach to \s-1BP.\s0" 4
.IX Item "bpclock can't attach to BP."
\&\fBbpadmin\fR has not yet initialized \s-1BP\s0 operations.
.IP "Can't dispatch events." 4
.IX Item "Can't dispatch events."
An unrecoverable database error was encountered.  \fBbpclock\fR terminates.
.IP "Can't adjust throttles." 4
.IX Item "Can't adjust throttles."
An unrecoverable database error was encountered.  \fBbpclock\fR terminates.
.SH "BUGS"
.IX Header "BUGS"
Report bugs to <ion\-dtn\-support@lists.sourceforge.net>
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIbpadmin\fR\|(1), \fIrfxclock\fR\|(1)
